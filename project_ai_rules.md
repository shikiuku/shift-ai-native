# AI Development Rules (project_ai_rules.md)

このファイルは、本プロジェクトにおいてAI（開発者）が遵守すべき行動指針とルールを定めたものです。
すべての作業はこのルールに基づいて実行してください。

## 1. 言語とコミュニケーション
- **使用言語**: 会話および応答はすべて**日本語**で行うこと。
- **コードのコメント**: コード内のコメントや説明文もすべて**日本語**で記述すること。
- **ドキュメント**: 実装計画 (implementation_plan.md) などのドキュメントもすべて**日本語**で記述すること。
- **確認の徹底**: 不明点や曖昧な点がある場合は、推測で進めずに**必ず即座に質問すること**。勝手な判断で実装を進めないこと。

## 2. コーディング規約と品質
- **ファイルサイズ制限**: 可読性とAIのコンテキスト理解を維持するため、1ファイルあたり**最大500行〜800行程度**に抑えることを目指す。これを超える場合はファイルの分割を検討・提案すること。
- **不要コードの即時削除**: 不要になったファイルやデッドコードは、確認が取れ次第、後回しにせず**即座に削除**すること。
- **変更範囲の限定**: 指示された箇所のみを変更すること。無関係な箇所の勝手なリファクタリングや変更は行わないこと（提案は可）。

## 3. プロジェクト管理とドキュメント
- **project.mdの常時更新**: コードや仕様に変更を加えるたびに、必ず `project.md` の内容（現状の仕様、進捗、構造など）を更新し、実態と乖離させないこと。
- **コンテキスト管理**: 毎回プロジェクト全体を無駄にメモリに展開しようとしないこと。必要なファイルのみを読み込み、コンテキスト（トークン）を節約すること。

## 4. バージョン管理 (Git)
- **コミットとプッシュ**: ユーザー（私）が**「コミットして」「プッシュして」と明示的に指示した時のみ**実行すること。作業完了＝コミットではない。確認を挟むこと。
- **コミットメッセージ**: **日本語**で記述すること。

## 5. 提案とフィードバック
- **積極的な提案**: 以下のような場合は遠慮なく提案を行うこと。
  - プロジェクト構造の改善案がある場合
  - 不要なコードやファイルを発見した場合
  - ユーザーの指示に技術的な誤りや矛盾がある場合
  - より良い実装方法がある場合

## 6. 環境・サーバー管理
- **開発サーバー**: 開発用サーバー (`npm run dev`) の起動・再起動・停止は**すべてユーザー（私）が行う**。AIが勝手に起動や停止を行わないこと。
- **ターミナル操作**: 必要なコマンドがある場合は提案を行うが、サーバーのプロセスに関わる操作は慎重に行うこと。

## 7. ルールの運用
- **ルールの追加・更新**: 開発中の対話を通じて、このルールファイル自体も随時更新される可能性がある。指示があった場合は即座にこのファイルを更新すること。

## 8. データベース管理・変更 (Supabase)
- **変更の自動化可能**: Supabaseのテーブル作成やカラム変更は、以下の手順で**CLIを使用して自動化可能**である。安易に「ユーザーにSQL実行をお願い」しないこと。
  1. `supabase/migrations` に新しいマイグレーションファイル (`YYYYMMDDHHMMSS_name.sql`) を作成する。
  2. `npx supabase db push` コマンドを実行する。
  3. 必要に応じて、ユーザーから提供された Access Token を使用してログインする (`npx supabase login --token ...`)。
- **Management APIの制限**: Management API (`api.supabase.com/v1/projects/.../query`) 経由のSQL実行は制限されている場合が多いため、CLI (`db push`) を第一選択とすること。

## 9. デザイン・UI/UX
- **影 (Shadow) の使用禁止**: カードやコンテナなどの要素に `shadow` クラス（ドロップシャドウ）を使用しないこと。フラットなデザインを基本とする。

## 10. ブラウザツールの使用とテスト
- **ブラウザツールの制限**: ブラウザツール（`browser_subagent`）を使用したテストや確認は、**ユーザーから明示的な指示があった場合のみ**実行すること。勝手にブラウザを起動して確認しないこと。
- **モバイル・iOS特有の問題**: 「PCでは表示されるがモバイル/iOSでは表示されない」といった問題は、PC上のブラウザエミュレーション（検証モード）でのテストは参考程度とし、まずは**コード分析（CSS、条件分岐、デバイス特性）**によって原因を特定・解決する計画を立てること。最終的な確認はユーザーに依頼するか、指示を仰ぐこと。
